<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <title>ONE PLAYER MODE</title>  
    
    <style>
        body {
            margin: 0;
            background: f2f2f2;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;

        }
    /* to hide mouse when game start */
    body.hide-cursor {
        cursor: none;
    }
 
        #gamearea {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: #ffffff;
        }

        #player {
            width: 35px;
            height: 35px;
            background: #007bff;/* ADD SPRITE LATER/*/
            position: absolute;
            border-radius: 5px;
        }

        #enemy {
            width: 32px;
            height: 32px;
            background: #ff0000;
            position: absolute;
            border-radius: 5px;
        }
        #gameover {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #ff0000;
            display: none; /* THIS IS ONLY TILL I MAKE ACTUAL END SCREEN */
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: #333333;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;

            #outsidestaminabar{
                position: absolute;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: 200px;
                height: 20px;
                background: #555555;
                border-radius: 10px;
            }
            #staminabar{
                width: 100%;
                height: 100%;
                background: #00ff00;
                border-radius: 10px;
                transition: width 0.2s ease;
            }
        }
    </style>
    </head>
    <body>
        <div id="gamearea">
            <div id="player"></div>
            <div id="enemy"></div>
            <div id="gameover">GAME OVER</div>
            <div id="score">Score: 0</div>
            <div id ='outsidestaminabar'>
                <div id ='staminabar'></div>
        </div>

        <script>
            const gameA = document.getElementById('gamearea');
            const player = document.getElementById('player');
            const enemy = document.getElementById('enemy');
            const gameOverText = document.getElementById('gameover');
            const scoreblock = document.getElementById("score")
            const accelleration = 0.89;
            const friction = 0.90;
            document.body.classList.add('hide-cursor');//starts gane with ni cursor
        

            let playerX = 200, playerY = 200;
            let enemyX = 600, enemyY = 600;
            let gamespeed = 5;
            let enemySpeed = 3;
            let pVelx = 0, pVely = 0;
            let eVelx = 0, eVely = 0;
            let enemyAcceleration = 0.7;
            let enemyFriction = 0.69;
            //dash power up variables
        
            let dashpower = 15;
            let dashcooldown = false;
            let dashcost = 40; 
            let stamina = 100;
            let maxstamina = 100;
            let staminarate = 0.4; //stamina regen rate
            //pause variable for esc
            let paused = false;
            let enemyspeedboost = 1;
            let running = true;



            let score = 0;
            let keys = {};

            document.addEventListener('keydown', (e) => {
                keys[e.key] = true;
            });

            document.addEventListener('keyup', (e) => {
                keys[e.key] = false;
            });
// escape button to pause game
            document.addEventListener('keydown', (e) => {
                if (e.key === "Escape") {
                    paused = !paused;
                    if (paused) {
                        document.body.classList.remove('hide-cursor');
                    } else {
                        document.body.classList.add('hide-cursor');
                    }
                }
            });
//dash function
function performDash() {
            document.addEventListener("keydown", e => {
    keys[e.key] = true;

    if (e.key === " " && !dashCooldown && stamina > dashCost) {
        performDash();
    }
    });
        }
        //functions
        function movePlayer() {
            if (keys['ArrowUp']) pVely -= accelleration;
            if (keys['ArrowDown']) pVely += accelleration;
            if (keys['ArrowLeft']) pVelx -= accelleration;
            if (keys['ArrowRight']) pVelx += accelleration;
            if (paused) return;

        //fristion
            pVelx *= friction;
            pVely *= friction;

            playerX += pVelx;
            playerY += pVely;

            const maxX = window.innerWidth - 35; //player width
            const maxY = window.innerHeight - 35; //player height

            if (playerX < 0) playerX = 0;
            if (playerY < 0) playerY = 0;
            if (playerX > maxX) playerX = maxX;
            if (playerY > maxY) playerY = maxY;
            player.style.left = playerX + "px";
            player.style.top = playerY + "px";
    
        }
        function performDash() {
            if (dashcooldown) return; // Prevent dashing if on cooldown

            // Calculate dash direction
            let dashDirX = 0;
            let dashDirY = 0;
            if (keys['ArrowUp']) dashDirY -= 1;
            if (keys['ArrowDown']) dashDirY += 1;
            if (keys['ArrowLeft']) dashDirX -= 1;
            if (keys['ArrowRight']) dashDirX += 1;

            // Normalize direction
            const length = Math.hypot(dashDirX, dashDirY);
            if (length === 0) return; // No movement keys pressed

            dashDirX /= length;
            dashDirY /= length;

            // Apply dash
            pVelx += dashDirX * dashpower;
            pVely += dashDirY * dashpower;

            // Start cooldown
            dashcooldown = true;
            setTimeout(() => {
                dashcooldown = false;
            }, 1000); // 1 second cooldown
            //enemy slown after dash
            enemyAcceleration *= 0.85;
        }
        //call dash function on spacebar press
        document.addEventListener('keydown', (e) => {
            if (e.key === ' '){
                performDash();
            }
        });
         //okay then add invisibility like ground power up

        


        //enemy math stuff
        function moveEnemy() {
            const dx = playerX - enemyX;
            const dy = playerY - enemyY;
            const angle = Math.atan2(dy,dx);
//change with acelleration and firction stuff
                eVelx += Math.cos(angle) * enemyAcceleration * enemyspeedboost;
                eVely += Math.sin(angle) * enemyAcceleration * enemyspeedboost;
            
            eVelx *= enemyFriction;
            eVely *= enemyFriction;
            enemyX += eVelx;
            enemyY += eVely;
            enemy.style.left = enemyX + "px";
            enemy.style.top = enemyY + "px";
        }

        function collisiondetection(){
            const pRect = player.getBoundingClientRect();
            const enemyRect = enemy.getBoundingClientRect(); //do not simplify enemy and rect

            const overlap = !(pRect.right < enemyRect.left || 
                              pRect.left > enemyRect.right || 
                              pRect.bottom < enemyRect.top || 
                              pRect.top > enemyRect.bottom);
            if (overlap) {
                gameOverText.style.display = 'block';
                running = false;
            }


        }
        function updatescore(){
            score++;
            scoreblock.textContent = "Score: " + score;
            //make enemy faster update
            if (score % 10 === 0){
                enemyspeedboost *= 1.0079;
        }
    }
        function gameLoop() {
            if (!running) return;
            movePlayer();
            moveEnemy();
            collisiondetection();
            updatescore();
            requestAnimationFrame(gameLoop);
            // Update stamina bar
            stamina = Math.min(maxstamina, stamina + staminarate);
            document.getElementById('staminabar').style.width = (stamina / maxstamina * 100) + '%';

        }
        setInterval(updatescore, 1000);
        requestAnimationFrame(gameLoop);
        gameLoop();
        </script>
    </body>
</html>
