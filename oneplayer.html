<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <title>ONE PLAYER MODE</title>  
    
    <style>
        body {
            margin: 0;
            background: #f2f2f2;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            overflow: hidden; /* Stops scrollbars from appearing */
        }
        .right img{
            max-width: 18%;
            height: 80%;
            object-fit: contain;
            position: absolute;
            top: 5px;
            right: 0;
            z-index: 0;
        }
    /* to hide mouse when game start */
    body.hide-cursor {
        cursor: none;
    }
 
        #gamearea {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: #ffffff;
        }

        #player {
            width: 35px;
            height: 35px;
            background: #007bff; 
            position: absolute;
            border-radius: 2px;
            background-image: url(players1.png);

            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
            position:absolute;
        }

        #enemy {
            width: 32px;
            height: 32px;
            background: #030000;
            position: absolute;
            border-radius: 2px;
            background-image: url(mouse.png);
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
            position:absolute;
        }
        #gameover {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #ff0000;
            display: none; 
            z-index: 10;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: #333333;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            z-index: 5;
        }
        #powerup {
            width: 22px;
            height: 22px;
            background: #b34eed;
            position: absolute;
            border-radius: 4px;
            background-image: url(mcpotion.png);
            
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
            position:absolute;

            display:none;
        }

         #outsidestaminabar{
                position: absolute;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: 200px;
                height: 20px;
                background: #555555;
                border-radius: 10px;
            }
            #staminabar{
                width: 100%;
                height: 100%;
                background: #febb20;
                border-radius: 10px;
                transition: width 0.1s linear;
            }  
            #midnightbird{
                width: 32px;
                height: 32px;
                background-size: contain;
                position:absolute;
                background-repeat: no-repeat
                ;
                z-index: 8;

                transition:left 4s linear;
               

            }
    </style>
    </head>
    <body>
        <div id="gamearea">
            <div id="powerup"></div>
            <div id="player"></div>
            <div id="enemy"></div>
            <div id="gameover">GAME OVER<br><span style="font-size: 20px; color: black"></span></div>
            <div id="score">Score: 0</div>
            <div id ='outsidestaminabar'>
                <div id ='staminabar'></div>
            </div>
            <div class ="right">
                <img src="gameinformation.png" alt="Game Icon" onerror="this.style.display='none'">
            </div>
        <script>
            const backgroundmusic = new Audio("02.mp3");
            backgroundmusic.loop = true;
            backgroundmusic.volume = 0.58;
            
            const pickup = new Audio("pickup.mp3");
            pickup.volume = 0.7;

            let musicHasStarted = false;

            // variables
            const gameA = document.getElementById('gamearea');
            const player = document.getElementById('player');
            const enemy = document.getElementById('enemy');
            const gameOverText = document.getElementById('gameover');
            const scoreblock = document.getElementById("score");
            
            const acceleration = 0.87; // 
            const friction = 0.90;
            document.body.classList.add('hide-cursor');

            let playerX = 200, playerY = 200;
            let enemyX = 600, enemyY = 600;
            
            let pVelx = 0, pVely = 0;
            let eVelx = 0, eVely = 0;
            let enemyAcceleration = 0.7;
            let enemyFriction = 0.92; // 

            // Dash variables
            let dashPower = 15;
            let dashCooldown = false;
            let dashCost = 50; 
            let stamina = 100;
            let maxStamina = 100;
            let staminarate = 0.4; 

            // Game State
            let paused = false;
            let enemyspeedboost = 1;
            let running = true;

            // Powerup variables
            let powerupact = false;
            let powerupx = 0;
            let powerupy = 0;
            let invis = false;

            // Wander variables
            let wanderx = 0;
            let wandery = 0;
            let wandertime = 0;

            let score = 0;
            let keys = {};


            document.addEventListener('keydown', (e) => {
                keys[e.key] = true;
                
                // MUSIC FIX: This is the ONLY place we try to start music initially
                if (!musicHasStarted && !paused) {
                    backgroundmusic.play().catch(error => {
                        console.log("Browser blocked audio:", error);
                    });
                    musicHasStarted = true; 
                }
            });

            document.addEventListener('keyup', (e) => {
                keys[e.key] = false;
            });

            // Escape to pause
            document.addEventListener('keydown', (e) => {
                if (e.key === "Escape") {
                    paused = !paused;

                    if (paused) {
                        document.body.classList.remove('hide-cursor');
                        backgroundmusic.pause();
                    } else {
                        document.body.classList.add('hide-cursor');
                        if (musicHasStarted) {
                            backgroundmusic.play();
                        }
                    }
                }
            });
            
            // Dash trigger
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space'){
                    performDash();
                }
            });

            // where the f the function

            function movePlayer() {
                if (keys['ArrowUp']) pVely -= acceleration;
                if (keys['ArrowDown']) pVely += acceleration;
                if (keys['ArrowLeft']) pVelx -= acceleration;
                if (keys['ArrowRight']) pVelx += acceleration;
                
                if (paused) return;

                pVelx *= friction;
                pVely *= friction;

                playerX += pVelx;
                playerY += pVely;

                const maxX = window.innerWidth - 35; 
                const maxY = window.innerHeight - 35; 

                if (playerX < 0) playerX = 0;
                if (playerY < 0) playerY = 0;
                if (playerX > maxX) playerX = maxX;
                if (playerY > maxY) playerY = maxY;
                player.style.left = playerX + "px";
                player.style.top = playerY + "px";
            }
            //hackclub bird use for homepage too id say got iddea from when people sayed theyd do it with em what ya call it like for desktop
            function hackclubbirdfly(){
            const bird = document.createElement("div");
            bird.classList.add(midnightbird);
            const flyH = math.random()*(window.innerHeight*0.5);

            bird.style.left = '-100px'; 
            bird.style.top = flyHeight + 'px';

            const gameArea = document.getElementById(gamearea);
            gameArea.appendChild(bird);

            setTimeout(() => {
                bird.style.left = `${window.innerWidth + 100}px`; 
            }, 50);

            setTimeout(() => {
            bird.remove(); 
             }, 4500); 

            setInterval(hackclubbirdfly, 15000);
            }
            

            function spawninvis(){
                const size = 22;
                let px = Math.random() * (window.innerWidth - size);
                let py = Math.random() * (window.innerHeight - size);
                const powerup = document.getElementById('powerup');
                powerup.style.left = px + "px";
                powerup.style.top = py + "px";
                powerup.style.display = 'block';
                powerupact = true;
            }

            function enemyWander(){
                if (wandertime-- <= 0){
                    const angle = Math.random() * Math.PI* 2;
                    wanderx = Math.cos(angle) * 2;
                    wandery = Math.sin(angle) * 2;
                    wandertime = 100;
                }
                enemyX += wanderx;
                enemyY += wandery;

                enemyspeedboost * 0.993;

                enemyX = Math.max(0, Math.min(enemyX, window.innerWidth -32));
                enemyY = Math.max(0, Math.min(enemyY, window.innerHeight -32));

                enemy.style.left = enemyX + "px";
                enemy.style.top = enemyY + "px";
            }

            function performDash() {
                if (dashCooldown) return; 
                if (stamina < dashCost) return; 
                
                stamina -= dashCost;

                let dashDirX = 0;
                let dashDirY = 0;
                if (keys['ArrowUp']) dashDirY -= 1;
                if (keys['ArrowDown']) dashDirY += 1;
                if (keys['ArrowLeft']) dashDirX -= 1;
                if (keys['ArrowRight']) dashDirX += 1;

                const length = Math.hypot(dashDirX, dashDirY);
                if (length === 0) return; 

                enemyspeedboost*0.984;

                dashDirX /= length;
                dashDirY /= length;

                pVelx += dashDirX * dashPower;
                pVely += dashDirY * dashPower;



                dashCooldown = true;
                setTimeout(() => {
                    dashCooldown = false;
                }, 300); 
            }

            function moveEnemy() {
                if (invis){
                    enemyWander();
                    return;
                }

                const dx = playerX - enemyX;
                const dy = playerY - enemyY;
                const angle = Math.atan2(dy,dx);

                eVelx += Math.cos(angle) * enemyAcceleration * enemyspeedboost;
                eVely += Math.sin(angle) * enemyAcceleration * enemyspeedboost;
                
                eVelx *= enemyFriction;
                eVely *= enemyFriction;
                enemyX += eVelx;
                enemyY += eVely;

                enemy.style.left = enemyX + "px";
                enemy.style.top = enemyY + "px";
            }

            function usepowerup() {
                invis = true;
                player.style.opacity = "0.3";
                setTimeout(() => {
                    invis = false;
                    player.style.opacity = "1";
                } , 1450);
            }

            function collisiondetection(){
                const pRect = player.getBoundingClientRect();
                const enemyRect = enemy.getBoundingClientRect(); 

                const overlap = !(pRect.right < enemyRect.left || 
                                  pRect.left > enemyRect.right || 
                                  pRect.bottom < enemyRect.top || 
                                  pRect.top > enemyRect.bottom);
                if (overlap) {
                    gameOverText.style.display = 'block';
                    running = false;
                    backgroundmusic.pause(); 
                    document.body.classList.remove('hide-cursor');
                }
            }

            function updatescore(){
                if(paused || !running) return;

                score++;
                scoreblock.textContent = "Score: " + score;
                
                // Difficulty increase
                if (score % 5 === 0){ 
                    enemyspeedboost += 0.05; 
                }
            }

            function gameLoop() {
                if (!running) return;
                
                // Do not update positions if paused
                if (!paused) {
                    movePlayer();
                    moveEnemy();
                    collisiondetection();

                    // POWERUP LOGIC
                    if (powerupact){
                        const pRect = player.getBoundingClientRect();
                        const powerupEl = document.getElementById('powerup');
                        const powerupRect = powerupEl.getBoundingClientRect();

                        const overlap = !(pRect.right < powerupRect.left || 
                                          pRect.left > powerupRect.right || 
                                          pRect.bottom < powerupRect.top || 
                                          pRect.top > powerupRect.bottom);
                        
                        if (overlap) {
                            usepowerup();
                            powerupEl.style.display = 'none';
                            powerupact = false;
                            
                            pickup.currentTime = 0;
                            pickup.play().catch(e => console.log("Sound error"));
                            
                            setTimeout(spawninvis, 7000); 
                        }
                    }

                    // Update stamina bar
                    stamina = Math.min(maxStamina, stamina + staminarate);
                    document.getElementById('staminabar').style.width = (stamina / maxStamina * 100) + '%';
                }

                requestAnimationFrame(gameLoop);
            }

            // Start the game
            spawninvis();
            setInterval(updatescore, 1000);
            gameLoop(); 
        </script>
    </body>
</html>
