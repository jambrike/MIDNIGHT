<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <title>ONE PLAYER MODE</title>  
    
    <style>
        body {
            margin: 0;
            background: #f2f2f2;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            overflow: hidden; /* Stops scrollbars from appearing */
        }
        .right img{
            max-width: 18%;
            height: 80%;
            object-fit: contain;
            position: absolute;
            top: 5px;
            right: 0;
            z-index: 0;
        }
    /* to hide mouse when game start */
    body.hide-cursor {
        cursor: none;
    }
 
        #gamearea {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: #ffffff;
            overflow: hidden;
        }

        #player {
            width: 35px;
            height: 35px;
            background: #007bff; 
            position: absolute;
            border-radius: 2px;
            background-image: url(players26.png);

            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
            position:absolute;
        }
        #gamearea.bg-default {
         background: #ffffff;
         background-image: none;
        }

        #enemy {
            width: 32px;
            height: 32px;
            background: #030000;
            position: absolute;
            border-radius: 2px;
            background-image: url(mouse26.png);
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
            position:absolute;
        }
        #gameover {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #ff0000;
            text-align: center;
            display: none; 
            z-index: 100;
            text-shadow: 2px 2px 0 #000;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: #333333;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            z-index: 5;
        }
        #powerup {
            width: 22px;
            height: 22px;
            background: #b34eed;
            position: absolute;
            border-radius: 4px;
            background-image: url(mcpotion26.png);
            
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
            position:absolute;

            display:none;
        }

         #outsidestaminabar{
                position: absolute;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: 200px;
                height: 20px;
                background: #555555;
                border-radius: 10px;
                z-index: 10;
            }
            #staminabar{
                width: 100%;
                height: 100%;
                background: #febb20;
                border-radius: 10px;
                transition: width 0.1s linear;
            }  
            #gamearea.bg-google{
                background-image: url(google.png);
                background-size:cover;
                background-color: #ffffff;
            }
            #gamearea.bg-midnnight{
                background-image: url(midnightweb.png);
                background-size:cover;
                background-color: #ffffff;
            }
            #gamearea.bg-reddit{
                background-image: url(reddit.png);
                background-size:cover;
                background-color: #ffffff;
            }
            .midnightbird{
                width: 40px;
                height: 40px;
                background-size: contain;
                position:absolute;
                background-repeat: no-repeat
                ;
                z-index: 8;

                transition:left 4s linear;
               

            }
    </style>
    </head>
    <body>
        <div id="gamearea">
            <div id="powerup"></div>
            <div id="player"></div>
            <div id="enemy"></div>
            
            <div id="gameover">
                GAME OVER
                <br>
                <span style="font-size: 24px; color: black; font-weight: bold;">
                    Press SPACE to Restart
                </span>
            </div>
            
            <div id="score">Score: 0</div>
            <div id ='outsidestaminabar'>
                <div id ='staminabar'></div>
            </div>
            <div class ="right">
                <img src="gameinformation.png" alt="Game Icon" onerror="this.style.display='none'">
            </div>
        <script>
            const backgroundmusic = new Audio("02.mp3");
            backgroundmusic.loop = true;
            backgroundmusic.volume = 0.58;
            
            const pickup = new Audio("pickup.mp3");
            pickup.volume = 0.7;

            let musicHasStarted = false;

            // variables
            const gameA = document.getElementById('gamearea');
            const player = document.getElementById('player');
            const enemy = document.getElementById('enemy');
            const gameOverText = document.getElementById('gameover');
            const scoreblock = document.getElementById("score");
            const powerupEl = document.getElementById('powerup'); // Added
            
            const acceleration = 0.87; // 
            const friction = 0.90;
            const birdFlapFrames = ["wing_up26.png", "wing_down26.png"]; 

            document.body.classList.add('hide-cursor');

            let playerX = 200, playerY = 200;
            let enemyX = 600, enemyY = 600;
            
            let pVelx = 0, pVely = 0;
            let eVelx = 0, eVely = 0;
            let enemyAcceleration = 0.7;
            let enemyFriction = 0.92; // 

            // Dash variables
            let dashPower = 15;
            let dashCooldown = false;
            let dashCost = 50; 
            let stamina = 100;
            let maxStamina = 100;
            let staminarate = 0.4; 

            // Game State
            let paused = false;
            let enemyspeedboost = 1;
            let running = true;

            // Powerup variables
            let powerupact = false;
            let invis = false;

            // Wander variables
            let wanderx = 0;
            let wandery = 0;
            let wandertime = 0;

            let score = 0;
            let keys = {};

            document.addEventListener('DOMContentLoaded', () => {
            const gameArea = document.getElementById('gamearea');
            const savedBackground = localStorage.getItem('gameBackground');
            if (savedBackground) {
                gameArea.classList.add(savedBackground);
            } else {
                gameArea.classList.add('bg-default');
    }
});


            document.addEventListener('keydown', (e) => {
                keys[e.key] = true;
                keys[e.code] = true; // Use code for Space
                
                // MUSIC FIX: This is the ONLY place we try to start music initially
                if (!musicHasStarted && !paused) {
                    backgroundmusic.play().catch(error => {
                        console.log("Browser blocked audio:", error);
                    });
                    musicHasStarted = true; 
                }
            });

            document.addEventListener('keyup', (e) => {
                keys[e.key] = false;
                keys[e.code] = false;
            });

            // Escape to pause
            document.addEventListener('keydown', (e) => {
                if (e.key === "Escape" && running) {
                    togglePause();
                }
            });
            
            // Dash trigger & Restart trigger
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space'){
                    if (running && !paused) {
                        performDash();
                    } else if (!running) {
                        resetGame(); // Restart game if game over
                    }
                }
            });

            function togglePause() {
                paused = !paused;

                if (paused) {
                    document.body.classList.remove('hide-cursor');
                    backgroundmusic.pause();
                } else {
                    document.body.classList.add('hide-cursor');
                    if (musicHasStarted) {
                        backgroundmusic.play();
                    }
                }
            }
            
            function resetGame() {
                // Reset positions
                playerX = window.innerWidth / 2 - 17;
                playerY = window.innerHeight / 2 - 17;
                enemyX = 100; 
                enemyY = 100;

                // Reset state/stats
                pVelx = 0; pVely = 0; eVelx = 0; eVely = 0;
                score = 0;
                scoreblock.textContent = "Score: 0";
                enemyspeedboost = 1;
                stamina = maxStamina;
                invis = false;
                player.style.opacity = "1";

                // Reset visuals/flow
                running = true;
                paused = false;
                gameOverText.style.display = 'none';
                document.body.classList.add('hide-cursor');
                
                spawninvis(); 
                
                if(musicHasStarted && backgroundmusic) {
                    backgroundmusic.currentTime = 0;
                    backgroundmusic.play();
                }
                
                requestAnimationFrame(gameLoop);
            }


            function startBirdFlapCycle(birdElement) {
                let frameIndex = 0;
                
                const flapInterval = setInterval(() => {
                    // Cycle between 0 and 1
                    frameIndex = 1 - frameIndex; 
                    
                    birdElement.style.backgroundImage = `url(${birdFlapFrames[frameIndex]})`;

                    if (!document.body.contains(birdElement)) {
                        clearInterval(flapInterval);
                    }
                    
                }, 100); // Flapping speed 
                
                return flapInterval; // Return the ID so we can stop it later
            }

            // where the f the function

            function movePlayer() {
                if (keys['ArrowUp']) pVely -= acceleration;
                if (keys['ArrowDown']) pVely += acceleration;
                if (keys['ArrowLeft']) pVelx -= acceleration;
                if (keys['ArrowRight']) pVelx += acceleration;
                
                if (paused) return;

                pVelx *= friction;
                pVely *= friction;

                playerX += pVelx;
                playerY += pVely;

                const maxX = window.innerWidth - 35; 
                const maxY = window.innerHeight - 35; 

                if (playerX < 0) { playerX = 0; pVelx *= -0.5; }
                if (playerY < 0) { playerY = 0; pVely *= -0.5; }
                if (playerX > maxX) { playerX = maxX; pVelx *= -0.5; }
                if (playerY > maxY) { playerY = maxY; pVely *= -0.5; }
                player.style.left = playerX + "px";
                player.style.top = playerY + "px";
            }
            //hackclub bird use for homepage too id say got iddea from when people sayed theyd do it with em what ya call it like for desktop
            function hackclubbirdfly() {
                if(paused || !running) return;

                const bird = document.createElement("div");
                bird.classList.add("midnightbird"); 
                
                // Randomly decide direction (50/50 chance)
                const isFlyingRight = Math.random() < 0.5; 

                let startX, endX;

                if (isFlyingRight) {
                    // Flying Left -> Right
                    startX = -100;
                    endX = window.innerWidth + 100;
                    
                    // YOUR IMAGE FACES LEFT.
                    // To face Right, we must FLIP it (-1).
                    bird.style.transform = "scaleX(-1)"; 
                } else {
                    // Flying Right -> Left
                    startX = window.innerWidth + 100;
                    endX = -100;
                    
                    // YOUR IMAGE FACES LEFT.
                    // To face Left, we keep it normal (1).
                    bird.style.transform = "scaleX(1)"; 
                }

                const flyH = Math.random() * (window.innerHeight * 0.6); 
                
                bird.style.left = startX + "px";
                bird.style.top = flyH + "px";
                bird.style.backgroundImage = `url(${birdFlapFrames[0]})`;
                
                document.getElementById("gamearea").appendChild(bird);

                const flapTimerID = startBirdFlapCycle(bird);

                requestAnimationFrame(() => {
                    bird.style.left = `${endX}px`; 
                });

                setTimeout(() => {
                    clearInterval(flapTimerID); 
                    if(bird.parentNode) bird.remove();
                }, 4000); 
            }


            // Start the loop
            setInterval(hackclubbirdfly, 15000);
            

            function spawninvis(){
                const size = 22;
                let px = Math.random() * (window.innerWidth - size - 50) + 25; // Adjusted range slightly
                let py = Math.random() * (window.innerHeight - size - 50) + 25;
                const powerup = document.getElementById('powerup');
                powerup.style.left = px + "px";
                powerup.style.top = py + "px";
                powerup.style.display = 'block';
                powerupact = true;
            }

            function enemyWander(){
                if (wandertime-- <= 0){
                    const angle = Math.random() * Math.PI* 2;
                    wanderx = Math.cos(angle) * 2;
                    wandery = Math.sin(angle) * 2;
                    wandertime = 100;
                }
                enemyX += wanderx;
                enemyY += wandery;

                enemyspeedboost *= 0.993;

                enemyX = Math.max(0, Math.min(enemyX, window.innerWidth -32));
                enemyY = Math.max(0, Math.min(enemyY, window.innerHeight -32));

                enemy.style.left = enemyX + "px";
                enemy.style.top = enemyY + "px";
            }

            function performDash() {
                if (dashCooldown) return; 
                if (stamina < dashCost) return; 
                
                stamina -= dashCost;

                let dashDirX = 0;
                let dashDirY = 0;
                if (keys['ArrowUp']) dashDirY -= 1;
                if (keys['ArrowDown']) dashDirY += 1;
                if (keys['ArrowLeft']) dashDirX -= 1;
                if (keys['ArrowRight']) dashDirX += 1;

                const length = Math.hypot(dashDirX, dashDirY);
                if (length === 0) return; 

                enemyspeedboost*=0.99;

                dashDirX /= length;
                dashDirY /= length;

                pVelx += dashDirX * dashPower;
                pVely += dashDirY * dashPower;



                dashCooldown = true;
                setTimeout(() => {
                    dashCooldown = false;
                }, 300); 
            }

            function moveEnemy() {
                if (invis){
                    enemyWander();
                    return;
                }

                const dx = playerX - enemyX;
                const dy = playerY - enemyY;
                const angle = Math.atan2(dy,dx);

                eVelx += Math.cos(angle) * enemyAcceleration * enemyspeedboost;
                eVely += Math.sin(angle) * enemyAcceleration * enemyspeedboost;
                
                eVelx *= enemyFriction;
                eVely *= enemyFriction;
                enemyX += eVelx;
                enemyY += eVely;

                enemy.style.left = enemyX + "px";
                enemy.style.top = enemyY + "px";
            }

            function usepowerup() {
                invis = true;
                player.style.opacity = "0.3";
                setTimeout(() => {
                    invis = false;
                    player.style.opacity = "1";
                } , 1450);
            }

            function collisiondetection(){
                const pRect = player.getBoundingClientRect();
                const enemyRect = enemy.getBoundingClientRect(); 

                const enemyOverlap = !(pRect.right < enemyRect.left || 
                                  pRect.left > enemyRect.right || 
                                  pRect.bottom < enemyRect.top || 
                                  pRect.top > enemyRect.bottom);
                
                if (enemyOverlap && !invis) {
                    gameOverText.style.display = 'block';
                    running = false;
                    backgroundmusic.pause(); 
                    document.body.classList.remove('hide-cursor');
                }
                //bassicaly 
                // POWERUP LOGIC Check
                if (powerupact){
                    const powerupRect = powerupEl.getBoundingClientRect();

                    const puOverlap = !(pRect.right < powerupRect.left || 
                                      pRect.left > powerupRect.right || 
                                      pRect.bottom < powerupRect.top || 
                                      pRect.top > powerupRect.bottom);
                    
                    if (puOverlap) {
                        usepowerup();
                        powerupEl.style.display = 'none';
                        powerupact = false;
                        
                        pickup.currentTime = 0;
                        pickup.play().catch(e => console.log("Sound error"));
                        
                        setTimeout(spawninvis, 7000); 
                    }
                }
            }

            function updatescore(){
                if(paused || !running) return;

                score++;
                scoreblock.textContent = "Score: " + score;
                
                // Difficulty increase
                if (score % 5 === 0){ 
                    enemyspeedboost += 0.05; 
                }
            }

            function gameLoop() {
                if (!running) return;
                
                // Do not update positions if paused
                if (!paused) {
                    movePlayer();
                    moveEnemy();
                    collisiondetection();

                    // Update stamina bar
                    stamina = Math.min(maxStamina, stamina + staminarate);
                    document.getElementById('staminabar').style.width = (stamina / maxStamina * 100) + '%';
                }

                requestAnimationFrame(gameLoop);
            }

            // Start the game
            spawninvis();
            setInterval(updatescore, 1000);
            gameLoop(); 
        </script>
    </body>
</html>
